- name: Deploy to VPS via SSH
  uses: appleboy/ssh-action@v0.1.8
  with:
    host: ${{ secrets.VPS_HOST }}
    username: ${{ secrets.VPS_USER }}
    key: ${{ secrets.VPS_SSH_KEY }}
    script: |
      cd ~/taprim

      echo "ğŸ§¾ Danh sÃ¡ch file hiá»‡n táº¡i:"
      ls -la

      echo "ğŸ“¦ Pull image má»›i nháº¥t"
      docker pull ${{ env.IMAGE_NAME }}:latest

      echo "ğŸ“„ Ghi file .env"
      cat <<EOF > .env
      ConnectionStrings__MyCnn=${{ secrets.MYCNN }}
      ConnectionStrings__Redis=${{ secrets.REDIS }}
      VietQr__ClientId=${{ secrets.VIETQR_CLIENTID }}
      VietQr__ApiKey=${{ secrets.VIETQR_APIKEY }}
      EOF

      echo "ğŸ” Kiá»ƒm tra docker-compose.yml cÃ³ tá»“n táº¡i khÃ´ng:"
      [ -f docker-compose.yml ] && echo "âœ… FOUND docker-compose.yml" || (echo "âŒ MISSING docker-compose.yml" && exit 1)

      echo "ğŸš€ Cháº¡y docker-compose up"
      docker-compose down -v --remove-orphans
      docker-compose pull
      docker-compose up -d --force-recreate

      echo "ğŸ“‹ Tráº¡ng thÃ¡i container:"
      docker ps
